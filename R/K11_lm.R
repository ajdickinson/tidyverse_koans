#:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
#                   Intro to the Tidyverse by Colleen O'Briant
#                                 Koan #11: lm()
#:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

# To complete this assignment, edit this R script inside the brackets for
# question 1, for example: between #1@ and @#1. Un-comment the line to make it
# live code instead of a comment (Ctrl Shift C on Windows; Cmd Shift C on Macs),
# save your progress (Ctrl/Cmd S), execute the code in the console (put your
# cursor in the piece of code and hit Ctrl/Cmd Return), and test your answer by
# running the test file (Ctrl/Cmd Shift T). When you've passed all tests, compile
# ("knit") the script to html (Ctrl/Cmd Shift K) and turn the html file in on
# Canvas.

#:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

# In this koan, you'll learn how to use lm() to estimate models with:

#   * log transformations,
#   * a squared term,
#   * no intercept,
#   * categorical variables (called "factors"),
#   * and interactions between variables.

# Run this code to get started:
library(tidyverse)
library(gapminder)

# Read the qelp docs on lm():
?qelp::lm

#:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

#                      ----- Transforming Variables ------
#
# 1. Take the simple regression we've been working on and apply a log ----------
# transformation to both the dependent variable and the explanatory variable by
# wrapping the variable names in the function log():
# lm(log(y) ~ log(x), data = gapminder).

#01@

# lm(__) %>%
#   broom::tidy(conf.int = TRUE)

# When GDP per capita increases by 1%, life expectancy will increase by __%.

#@01


# 2. Instead of applying log() to both the dependent and explanatory -----------
# variable, apply it only to the explanatory variable. Does the R-squared
# improve?

#02@

# lm(__) %>%
#   broom::glance()

#@02


# 3. Instead of doing a log transformation, try taking the square --------------
# of gdpPercap. You'll need to wrap the transformation in I(), which "inhibits
# the interpretation" of arithmetic operators like "+", "-", "*", and "^" in
# formulas. So the formula will look like: lm(y ~ I(x^2), data = gapminder).
# What's the R-squared now? Does a log transformation, square transformation,
# or no transformation at all of gdpPercap seem to be the best fit?

#03@

# lm(__) %>%
#   broom::glance()

# This model explains __% of the variation in lifeExp.

#@03

#:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

# 4. If you wanted to omit the intercept term, you can do that like this: ------
#    lm(y ~ 0 + x, data = gapminder). Take the simple regression and omit
#    the intercept.

#04@

# lm(__) %>%
#   broom::tidy(conf.int = TRUE)

#@04


# 5. Take the simple regression we've been working on and add a second --------
# explanatory variable: 'year'.

#05@

# lm(__ ~ __ + __, data = __) %>%
#   broom::tidy(conf.int = TRUE)

# Every year, a country's life expectancy is expected to increase by __ years.

#@05


# 6. Take out 'year' from the model and add 'continent'. This variable --------
# is different from the numerical variables we've been working with (lifeExp,
# gdpPercap, and year are all numeric). 'continent' is a "factor" variable,
# which means the data is categorical rather than numeric. When you add
# 'continent', lm() lets different continents have different intercepts.

#06@

# lm(__ ~ __ + __, data = __) %>%
#   broom::tidy(conf.int = TRUE)

# What happened to Africa? One level has to be omitted to avoid the dummy
# variable trap. So the intercept is the OLS prediction for the intercept for
# Africa. It's saying that if a country in Africa has a GDP per capita of $0
# (which is nonsense), the life expectancy of the people in that country is
# expected to be 47.9 years. The intercept for a country in the Americas is
# 47.9 + 13.6 = 61.5 years.

# Our model predicts that a country in Asia with $0 GDP per capita will have a
# life expectancy of __ years.

#@06

#:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

# In the previous question, we learned that you can allow different continents
# to have different *intercepts* by including 'continent' as an explanatory
# variable.

# You can also allow different continents to have different *slopes* by
# including an interaction between 'continent' and another variable like
# 'gdpPercap'.

# 7. Estimate a model of lifeExp where the explanatory variable is ------------
# the interaction between 'gdpPercap' and 'continent'. Hint: an interaction
# between x and z is done like this: lm(y ~ x:z, data = gapminder)

#07@

# lm(__) %>%
#   broom::tidy(conf.int = TRUE)

# According to our model, a $1 larger GDP per capita can be associated with a
# __ year higher life expectancy in Europe.

#@07


# Note: When you include interactions between variables, you usually also
# include the variables by themselves: y ~ x + z + x:z. That way, you're letting
# both the slope and the intercept vary by the variables. A shorthand for that
# specification is this: y ~ x*z.

#:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

# Great work! You're one step closer to tidyverse enlightenment. Make sure to
# return to this topic to meditate on it later.

# If you're ready, you can move on to koan 12: stats in R.
